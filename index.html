<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Print Your Photos</title>
</head>
<body>
    <h1>Upload Your Pictures</h1>
    <form id="imageForm">
        <label for="image1">Choose picture 1:</label>
        <input type="file" id="image1" name="image1" accept="image/*" required><br><br>

        <label for="image2">Choose picture 2:</label>
        <input type="file" id="image2" name="image2" accept="image/*"><br><br>

        <label for="image3">Choose picture 3:</label>
        <input type="file" id="image3" name="image3" accept="image/*"><br><br>

        <label for="image4">Choose picture 4:</label>
        <input type="file" id="image4" name="image4" accept="image/*"><br><br>

        <label for="paper_size">Select paper size:</label>
        <select id="paper_size" required>
            <option value="A4">A4</option>
            <option value="Legal">Legal</option>
            <option value="Letter">Letter</option>
        </select><br><br>

        <label for="orientation">Select orientation:</label>
        <select id="orientation" required>
            <option value="portrait">Portrait</option>
            <option value="landscape">Landscape</option>
        </select><br><br>

        <label for="picture_size">Select picture size:</label>
        <select id="picture_size" required>
            <option value="wallet">Wallet Size (2"x3")</option>
            <option value="2r">2R (2.5"x3.5")</option>
            <option value="3r">3R (3.5"x5")</option>
            <option value="4r">4R (4"x6")</option>
            <option value="5r">5R (5"x7")</option>
        </select><br><br>

        <label for="layout">Select picture layout (Rows x Columns):</label>
        <select id="layout" required>
            <option value="1x1">1x1 (1 picture per page)</option>
            <option value="1x2">1x2 (1 column, 2 rows)</option>
            <option value="1x3">1x3 (1 column, 3 rows)</option>
            <option value="2x1">2x1 (2 columns, 1 row)</option>
            <option value="2x2">2x2 (2 columns, 2 rows)</option>
            <option value="2x3">2x3 (2 columns, 3 rows)</option>
            <option value="3x2">3x2 (3 columns, 2 rows)</option>
            <option value="3x3">3x3 (3 columns, 3 rows)</option>
            <option value="3x4">3x4 (3 columns, 4 rows)</option>
        </select><br><br>

        <button type="button" onclick="generatePDF()">Generate PDF</button>
    </form>

    <!-- Iframe to preview the PDF -->
    <h2>PDF Preview:</h2>
    <iframe id="pdfPreview" style="width: 100%; height: 500px;"></iframe>

    <canvas id="canvas" style="display: none;"></canvas>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
    
    <script>
        async function generatePDF() {
            const { jsPDF } = window.jspdf;

            const paperSize = document.getElementById('paper_size').value;
            const orientation = document.getElementById('orientation').value;
            const pictureSize = document.getElementById('picture_size').value;
            const layout = document.getElementById('layout').value;

            // Determine the page size and orientation
            let doc;
            if (paperSize === 'A4') {
                doc = new jsPDF({
                    orientation: orientation,
                    unit: 'mm',
                    format: 'a4'
                });
            } else if (paperSize === 'Legal') {
                doc = new jsPDF({
                    orientation: orientation,
                    unit: 'mm',
                    format: [216, 356]  // Legal size in mm
                });
            } else if (paperSize === 'Letter') {
                doc = new jsPDF({
                    orientation: orientation,
                    unit: 'mm',
                    format: 'letter'
                });
            }

            // Picture size in mm
            let imgWidth, imgHeight;
            if (pictureSize === 'wallet') {
                imgWidth = 50.8;
                imgHeight = 76.2;
            } else if (pictureSize === '2r') {
                imgWidth = 63.5;
                imgHeight = 88.9;
            } else if (pictureSize === '3r') {
                imgWidth = 88.9;
                imgHeight = 127;
            } else if (pictureSize === '4r') {
                imgWidth = 101.6;
                imgHeight = 152.4;
            } else if (pictureSize === '5r') {
                imgWidth = 127;
                imgHeight = 177.8;
            }

            const imageFiles = [
                document.getElementById('image1').files[0],
                document.getElementById('image2').files[0],
                document.getElementById('image3').files[0],
                document.getElementById('image4').files[0]
            ].filter(Boolean); // Only include non-null files

            const canvas = document.getElementById('canvas');
            const ctx = canvas.getContext('2d');

            // Determine the layout (rows and columns)
            let cols, rows;
            if (layout === '1x1') {
                rows = 1; cols = 1;
            } else if (layout === '1x2') {
                rows = 2; cols = 1;
            } else if (layout === '1x3') {
                rows = 3; cols = 1;
            } else if (layout === '2x1') {
                rows = 1; cols = 2;
            } else if (layout === '2x2') {
                rows = 2; cols = 2;
            } else if (layout === '2x3') {
                rows = 3; cols = 2;
            } else if (layout === '3x2') {
                rows = 2; cols = 3;
            } else if (layout === '3x3') {
                rows = 3; cols = 3;
            } else if (layout === '3x4') {
                rows = 3; cols = 4;
            }

            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();
            const cellWidth = pageWidth / cols;
            const cellHeight = pageHeight / rows;

            for (let i = 0; i < imageFiles.length; i++) {
                const image = imageFiles[i];
                const img = new Image();
                const url = URL.createObjectURL(image);
                
                img.src = url;

                await new Promise((resolve) => {
                    img.onload = () => {
                        canvas.width = imgWidth;
                        canvas.height = imgHeight;
                        ctx.drawImage(img, 0, 0, imgWidth, imgHeight);

                        const imgData = canvas.toDataURL('image/jpeg');
                        const col = i % cols;
                        const row = Math.floor(i / cols);

                        // Calculate position for centering the image
                        const xOffset = (cellWidth - imgWidth) / 2;
                        const yOffset = (cellHeight - imgHeight) / 2;

                        const x = col * cellWidth + xOffset;
                        const y = row * cellHeight + yOffset;

                        doc.addImage(imgData, 'JPEG', x, y, imgWidth, imgHeight);
                        resolve();
                    };
                });

                if ((i + 1) % (cols * rows) === 0 && i < imageFiles.length - 1) {
                    doc.addPage();
                }
            }

            const pdfBlob = doc.output('blob');
            const pdfUrl = URL.createObjectURL(pdfBlob);
            document.getElementById('pdfPreview').src = pdfUrl;
        }
    </script>
</body>
</html>
